diff --git a/contracts/UniswapV2.sol b/contracts/UniswapV2.sol
index 7acf0b39..17cd551e 100644
--- a/contracts/UniswapV2.sol
+++ b/contracts/UniswapV2.sol
@@ -105,21 +105,13 @@ contract UniswapV2 is IUniswapV2, ERC20("Uniswap V2", "UNI-V2", 18, 0) {
             amountIn = balance0.sub(reserve0);
             require(amountIn > 0, "UniswapV2: INSUFFICIENT_INPUT_AMOUNT");
             fee = feeRecipient == address(0) ? 0 : uint(amountIn).mul(3) / 5000;
+            require(amountIn.mul(reserve1 - amountOut).mul(fee > 0 ? 9976 : 9970) >= amountOut.mul(reserve0).mul(10000), "UniswapV2: K");
+            _safeTransfer(token1, msg.sender, amountOut);
+            balance1 = IERC20(token1).balanceOf(address(this));
             if (fee > 0) {
-                require(
-                    amountIn.sub(fee).mul(reserve1 - amountOut).mul(9976) >= amountOut.mul(reserve0).mul(10000),
-                    "UniswapV2: K_VIOLATED"
-                );
                 _safeTransfer(token0, feeRecipient, fee);
-                balance0 = IERC20(token0).balanceOf(address(this)); // re-fetch balance after the transfer
-            } else {
-                require(
-                    amountIn.mul(reserve1 - amountOut).mul(997) >= amountOut.mul(reserve0).mul(1000),
-                    "UniswapV2: K_VIOLATED"
-                );
+                balance0 = IERC20(token0).balanceOf(address(this));
             }
-            _safeTransfer(token1, msg.sender, amountOut);
-            balance1 = IERC20(token1).balanceOf(address(this));
         } else {
             require(tokenIn == token1, "UniswapV2: INVALID_INPUT_TOKEN");
             require(0 < amountOut && amountOut < reserve0, "UniswapV2: INVALID_OUTPUT_AMOUNT");
@@ -127,21 +119,14 @@ contract UniswapV2 is IUniswapV2, ERC20("Uniswap V2", "UNI-V2", 18, 0) {
             amountIn = balance1.sub(reserve1);
             require(amountIn > 0, "UniswapV2: INSUFFICIENT_INPUT_AMOUNT");
             fee = feeRecipient == address(0) ? 0 : uint(amountIn).mul(3) / 5000;
+            require(amountIn.mul(reserve0 - amountOut).mul(fee > 0 ? 9976 : 9970) >= amountOut.mul(reserve1).mul(10000), "UniswapV2: K");
+            _safeTransfer(token0, msg.sender, amountOut);
+            balance0 = IERC20(token0).balanceOf(address(this));
+            fee = feeRecipient == address(0) ? 0 : uint(amountIn).mul(3) / 5000;
             if (fee > 0) {
-                require(
-                    amountIn.sub(fee).mul(reserve0 - amountOut).mul(9976) >= amountOut.mul(reserve1).mul(10000),
-                    "UniswapV2: K_VIOLATED"
-                );
                 _safeTransfer(token1, feeRecipient, fee);
-                balance1 = IERC20(token1).balanceOf(address(this)); // re-fetch balance after the transfer
-            } else {
-                require(
-                    amountIn.mul(reserve0 - amountOut).mul(997) >= amountOut.mul(reserve1).mul(1000),
-                    "UniswapV2: K_VIOLATED"
-                );
+                balance1 = IERC20(token1).balanceOf(address(this));
             }
-            _safeTransfer(token0, msg.sender, amountOut);
-            balance0 = IERC20(token0).balanceOf(address(this));
         }
 
         _update(balance0, balance1);
